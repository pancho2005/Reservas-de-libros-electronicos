<!DOCTYPE html>
<html>
<head>
    <title>Sistema Web - Biblioteca</title>
    <style>
        body {
            font-family: Arial;
            background-color: #f4f6f9;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
        }

        .card {
            background: white;
            padding: 20px;
            margin: 20px auto;
            width: 400px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        input {
            width: 90%;
            padding: 8px;
            margin: 5px 0;
        }

        button {
            padding: 10px;
            margin-top: 10px;
            cursor: pointer;
        }

        #resultado {
            margin-top: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            white-space: pre-wrap;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>
<body>

<h1>Sistema Web - Biblioteca</h1>

<div class="card">
    <h3>Crear Usuario</h3>
    <input id="nombre" placeholder="Nombre">
    <input id="apellido" placeholder="Apellido">
    <button onclick="crearUsuario()">Crear Usuario</button>
</div>

<div class="card">
    <h3>Crear Libro</h3>
    <input id="titulo" placeholder="TÃ­tulo">
    <input id="autor" placeholder="Autor">
    <input id="stock" type="number" placeholder="Stock">
    <button onclick="crearLibro()">Crear Libro</button>
</div>

<div class="card">
    <h3>Crear Reserva</h3>
    <input id="usuario_id" type="number" placeholder="ID Usuario">
    <input id="libro_id" type="number" placeholder="ID Libro">
    <button onclick="crearReserva()">Crear Reserva</button>
</div>

<div class="card">
    <button onclick="listarUsuarios()">Listar Usuarios</button>
    <button onclick="listarLibros()">Listar Libros</button>
    <button onclick="listarReservas()">Listar Reservas</button>
    <button onclick="totalReservas()">Total Reservas</button>
</div>

<div id="resultado"></div>

<script>

function mostrarResultado(data, esError=false) {
    const resultado = document.getElementById("resultado");
    resultado.className = esError ? "error" : "success";
    resultado.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
}

function crearUsuario() {
    fetch('/usuarios', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            nombre: document.getElementById("nombre").value,
            apellido: document.getElementById("apellido").value
        })
    })
    .then(res => res.json())
    .then(data => mostrarResultado(data));
}

function crearLibro() {
    fetch('/libros', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            titulo: document.getElementById("titulo").value,
            autor: document.getElementById("autor").value,
            stock: parseInt(document.getElementById("stock").value)
        })
    })
    .then(res => res.json())
    .then(data => mostrarResultado(data));
}

function crearReserva() {
    fetch('/reservas', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            usuario_id: parseInt(document.getElementById("usuario_id").value),
            libro_id: parseInt(document.getElementById("libro_id").value)
        })
    })
    .then(res => {
        if (!res.ok) {
            return res.text().then(text => { throw new Error(text) });
        }
        return res.json();
    })
    .then(data => mostrarResultado(data))
    .catch(error => mostrarResultado(error.message, true));
}

function listarUsuarios() {
    fetch('/usuarios/listar')
        .then(res => res.json())
        .then(data => mostrarResultado(data));
}

function listarLibros() {
    fetch('/libros/listar')
        .then(res => res.json())
        .then(data => mostrarResultado(data));
}

function listarReservas() {
    fetch('/reservas/listar')
        .then(res => res.json())
        .then(data => mostrarResultado(data));
}

function totalReservas() {
    fetch('/reportes/total')
        .then(res => res.json())
        .then(data => mostrarResultado(data));
}

</script>

</body>
</html>
